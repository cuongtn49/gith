<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/fill4.css">
    <link rel="stylesheet" href="./css/home.css">
    <title>Document</title>
</head>
<style>
    #group-btn {
        text-align: center;
    }

    #show-answer {
        margin-top: 20px;
        padding: 15px 20px;
        background: #fdfcfe;
        border: 2px dashed #00acc1;
        border-radius: 8px;
        text-align: center;
        color: #34495e;
        font-size: 18px;
        font-weight: 600;
        box-shadow: 0 4px 8px rgba(0, 172, 193, 0.2);
        transition: all 0.3s ease-in-out;
    }

    #show-answer.correct {
        background: #e8f5e9;
        border-color: #4caf50;
        color: #388e3c;
    }

    #show-answer.incorrect {
        background: #ffebee;
        border-color: #e57373;
        color: #c62828;
    }

    #show-answer.fade-in {
        animation: fadeIn 0.6s ease-in-out;
    }

    @keyframes fadeIn {
        0% {
            opacity: 0;
            transform: translateY(-10px);
        }

        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<body>
    <div id="Home">
        <a href="mobie.html"><img id="img-home" src="image/3d-house.png" alt=""></a>
    </div>
    <div id="body-fill">
        <div class="fill-setup" id="fill-setup">
            <h2>C√†i ƒë·∫∑t ch·∫ø ƒë·ªô ƒêi·ªÅn t·ª´</h2>
            <label>
                <input type="radio" name="fill-mode" value="question" id="fillAnswer" checked /> ƒêi·ªÅn ƒë√°p √°n
            </label>
            <label>
                <input type="radio" name="fill-mode" value="answer" /> ƒêi·ªÅn c√¢u h·ªèi
            </label>
            <label>
                <input type="checkbox" name="fill-mode" value="answer" id="random" /> C√¢u h·ªèi ng·∫´u nhi√™n
            </label>
            <label>
                <input type="checkbox" name="fill-mode" value="answer" id="limitLength" checked /> Gi·ªõi s·ªë h·∫°n k√≠ t·ª±
                nh·∫≠p v√†o
            </label>
            <br />
            <label>
                S·ªë l∆∞·ª£ng c√¢u h·ªèi:
                <input type="number" id="fill-count" value="5" min="1" />
            </label>
            <button class="button-fill" id="start-fill-btn"
                style="display: block; margin: 0 auto; margin-top: 40px;">B·∫Øt ƒë·∫ßu</button>
        </div>

        <div class="fill-container" id="fill-container" style="display: none;">
            <h2 id="fill-instruction">Instruction goes here...</h2>
            <h3 id="fill-question">Question or Answer goes here...</h3>
            <input type="text" id="fill-input" placeholder="Enter your answer here..." autocomplete="off" />
            <p id="fill-feedback" style="visibility: hidden;">answer</p>
            <div id="group-btn">
                <button class="button-fill" id="submit-fill-btn">Submit</button>
                <button class="button-fill" id="next-fill-btn">Next</button>
            </div>
            <!-- <div id="show-answer"></div> -->
        </div>
        <div id="fill-finish" style="display: none;">
            üéâ B·∫°n ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc! üéâ
            <span>Ch√∫c m·ª´ng b·∫°n v·ªõi k·∫øt qu·∫£ tuy·ªát v·ªùi!</span>
            <span id="fill-score" style="font-weight: 900;">ƒêi·ªÉm s·ªë: 0</span>
            <span id="fill-correct">S·ªë c√¢u ƒë√∫ng: 0</span>
            <span id="fill-wrong">S·ªë c√¢u sai: 0</span>
        </div>
        <div id="review" style="display: none;">
            <h2>K·∫øt qu·∫£ Chi Ti·∫øt</h2>
            <table id="review-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>C√¢u h·ªèi</th>
                        <th>C√¢u tr·∫£ l·ªùi</th>
                        <th>K·∫øt qu·∫£</th>
                    </tr>
                </thead>
                <tbody id="data-row">
                    <!-- C√°c h√†ng d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                </tbody>
            </table>
        </div>
    </div>
    <script>
        var flashcards = JSON.parse(localStorage.getItem("data")) || [];
        var list = [];
        const form = document.getElementById("fill-setup");
        var formatFill = document.getElementById("fillAnswer").checked;
        const numberQuestion = document.getElementById("fill-count");
        const submitForm = document.getElementById("start-fill-btn");

        const fillContainer = document.getElementById("fill-container");
        const questionOrder = document.getElementById("fill-instruction");
        const question = document.getElementById("fill-question");
        const answer = document.getElementById("fill-input");
        const checkedBtn = document.getElementById("submit-fill-btn");
        const nextBtn = document.getElementById("next-fill-btn");
        const feedback = document.getElementById("fill-feedback");

        const finishBox = document.getElementById("fill-finish");
        const score = document.getElementById("fill-score");
        const correct = document.getElementById("fill-correct");
        const wrong = document.getElementById("fill-wrong");

        const reviewBox = document.getElementById("review");
        const dataRow = document.getElementById("data-row");

        var incorrect = [];
        var index = 0;
        var isRandom;
        var limitLength;
        numberQuestion.focus();
        numberQuestion.value = flashcards.length;

        numberQuestion.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                begin();
            }
        });

        submitForm.addEventListener("click", () => {
            begin();
        });
        nextBtn.addEventListener("click", () => {
            incorrect[index] = 1;
            next();
        });
        checkedBtn.addEventListener("click", () => {

            checkedAnswer(list);
        });
        answer.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                checkedAnswer(list);
            }
        });

        function begin() {
            formatFill = document.getElementById("fillAnswer").checked;
            isRandom = document.getElementById("random").checked;
            limitLength = document.getElementById("limitLength").checked;

            n = document.getElementById("fill-count").value;

            form.style.display = "none";
            fillContainer.style.display = "block";

            index = 0;
            incorrect = new Array(5);
            incorrect.fill(0);


            list = flashcards.map(element => {
                if (formatFill) {
                    return { question: element.question, answer: element.answer, yourAnswer: "" };
                } else {
                    return { question: element.answer, answer: element.question, yourAnswer: "" }
                }
            });
            if (isRandom) list = list.sort(() => Math.random() - 0.5);
            list = list.slice(0, n);
            display();
        }

        function display() {
            setFillBox();
            questionOrder.textContent = `QUESTION ${index + 1}`;
            question.textContent = list[index].question;
        }
        function next() {
            if (index < list.length - 1) {
                index++;
                display();
            } else {
                rating();
                finishBox.style.display = 'block';
                fillContainer.style.display = "none";
            }
        }
        function setFillBox() {
            answer.focus();
            answer.value = "";
            answer.style.background = "white";
            feedback.style.visibility = "hidden";
            if (limitLength) answer.maxLength = list[index].answer.length;
        }
        function checkedAnswer(data) {
            const yourAnswer = answer.value.trim();
            const correctAnswers = data[index].answer.split(",").map(a => a.trim());
            const yourAnswerList = yourAnswer.split(",").map(a => a.trim());
            const isRight = yourAnswerList.every(ans => correctAnswers.includes(ans));
            saveYourAnswer(yourAnswer);
            if (isRight) {
                answer.style.background = "rgba(0, 255, 0, 0.2)";
                setTimeout(() => {
                    next();
                }, 1000)

            } else {
                answer.style.background = "rgba(255, 0, 0, 0.2)";
                feedback.textContent = list[index].answer;
                feedback.style.visibility = "visible";
                incorrect[index] = 1;
                wrongAnswer();
            }
        }
        function wrongAnswer(){
            answer.value = "";
            answer.focus();
        }
        function saveYourAnswer(yourAnswer) {
            if (list[index].yourAnswer.length === 0) list[index].yourAnswer = yourAnswer;
            else list[index].yourAnswer += " - " + yourAnswer;
        }
        function rating() {
            console.log(incorrect);
            var countFalse = 0;
            for (let i = 0; i < incorrect.length; i++) {
                if (incorrect[i] === 1) countFalse++;
            }
            correct.textContent = `S·ªë c√¢u ƒë√∫ng: ${list.length - countFalse}`;
            wrong.textContent = `S·ªë c√¢u sai: ${countFalse}`;
            score.textContent = `ƒêi·ªÉm s·ªë: ${(parseFloat(((list.length - countFalse) / list.length) * 10)).toFixed(1)}`;
            review();
        }
        function review() {
            dataRow.innerHTML = "";
            for (let i = 0; i < list.length; i++) {
                const tr = document.createElement("tr");
                tr.innerHTML =
                    `<td>${i + 1}</td>
                <td>${list[i].question}</td>
                <td>${list[i].yourAnswer}</td>
                <td>${list[i].answer}</td>`;
                dataRow.appendChild(tr);
            }
            reviewBox.style.display = "block";
        }
    </script>
</body>

</html>